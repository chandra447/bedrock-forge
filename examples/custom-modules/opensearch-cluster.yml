# Example: Custom module with dependencies for OpenSearch cluster
kind: CustomModule
metadata:
  name: bedrock-opensearch
  description: OpenSearch cluster for Bedrock knowledge base vector storage
spec:
  # Git repository module
  source: "git::https://github.com/your-org/terraform-opensearch-module.git"
  version: "v1.2.0"
  
  # Depends on VPC being created first
  dependsOn:
    - "bedrock-vpc"
  
  variables:
    cluster_name: "bedrock-knowledge-base"
    engine_version: "OpenSearch_2.3"
    instance_type: "t3.small.search"
    instance_count: 2
    
    # Reference VPC outputs from the bedrock-vpc module
    vpc_id: "${module.bedrock_vpc.vpc_id}"
    subnet_ids: "${module.bedrock_vpc.private_subnets}"
    
    # Security configuration
    encrypt_at_rest: true
    node_to_node_encryption: true
    
    # Access policy
    access_policies: |
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Principal": {
              "AWS": "*"
            },
            "Action": "es:*",
            "Resource": "arn:aws:es:*:*:domain/bedrock-knowledge-base/*"
          }
        ]
      }
    
    tags:
      Environment: "${var.environment}"
      Purpose: "BedrockKnowledgeBase"
      ManagedBy: "bedrock-forge"
  
  description: "OpenSearch cluster for vector storage in Bedrock knowledge bases"